---
layout: default
---

## Equation 6 as a loss function

The original equation:

$$
\rho\left(\frac{\partial {v}}{\partial t}+{v} \cdot \nabla {v}\right)=\frac{1}{c} {J} \times {B}-\nabla P+\rho {g}+\nabla \cdot(\nu \rho \nabla {v})
$$

For static approximation, $$\frac{\partial {v}}{\partial t} = -\Omega_{\text{rot}}\frac{\partial{v}}{\partial \phi}$$ yields:

$$
\rho\left(-\Omega_{\text{rot}}\frac{\partial{v}}{\partial \phi}+{v} \cdot \nabla {v}\right)=\frac{1}{c} {J} \times {B}-\nabla P+\rho {g}+\nabla \cdot(\nu \rho \nabla {v})
$$


## Spherical math 101

Let $$F(r, \theta, \phi) = F_r\mathbf{\hat{e}}_r + F_{\theta}\mathbf{\hat{e}}_{\theta} + F_{\phi}\mathbf{\hat{e}}_{\phi}$$ be our spherical field, where $$F_i$$ is the vector field in each direction and $$\mathbf{\hat{e}}_i$$ is the unit vector for each direction.

### 1. Product rule:

We know that for $$w(x,y)=u(x,y)v(x,y)$$, $$\frac{\partial{w}}{\partial{x}}=\frac{\partial{u}}{\partial{x}}v + \frac{\partial{v}}{\partial{x}}u$$.

In a spherical system:

$$
\frac{\partial{F}}{\partial{q}}=(\frac{\partial{F_r}}{\partial{q}}\mathbf{\hat{e}}_r + \frac{\partial{\mathbf{\hat{e}}_r}}{\partial{q}}F_r) + (\frac{\partial{F_{\theta}}}{\partial{q}}\mathbf{\hat{e}}_\theta + \frac{\partial{\mathbf{\hat{e}}_\theta}}{\partial{q}}F_\theta) + (\frac{\partial{F_{\phi}}}{\partial{q}}\mathbf{\hat{e}}_\phi + \frac{\partial{\mathbf{\hat{e}}_\phi}}{\partial{q}}F_\phi)
$$


### 2. Physical, arc-length derivatives

Some spherical scaling factors are incorporated.

$$
\begin{aligned}
\frac{\partial}{\partial{s_r}} = \frac{\partial}{\partial{r}}, \quad\frac{\partial}{\partial{s_\theta}} = \frac{1}{r}\frac{\partial}{\partial{\theta}},\quad\frac{\partial}{\partial{s_\phi}} = \frac{1}{r\text{sin}\theta}\frac{\partial}{\partial{\phi}}
\end{aligned}
$$


### 3. Unit vector derivatives - <a href="https://youtu.be/JQl9L1CiTZs?si=qtHDyPI1pW6Lv60N">reference</a>

#### 3.1. w.r.t $$r$$:
$$
\frac{\partial \hat{\mathbf e}_r}{\partial r}
=
\frac{\partial \hat{\mathbf e}_\theta}{\partial r}
=
\frac{\partial \hat{\mathbf e}_\phi}{\partial r}
=
0
$$

#### 3.2. w.r.t $$\theta$$:
$$
\begin{aligned}
\frac{\partial \hat{\mathbf e}_r}{\partial \theta} = \hat{\mathbf e}_\theta,\quad \frac{\partial \hat{\mathbf e}_\theta}{\partial \theta} = -\hat{\mathbf e}_r,\quad\frac{\partial \hat{\mathbf e}_\phi}{\partial \theta} = 0
\end{aligned}
$$


#### 3.3. w.r.t $$\phi$$:
$$
\begin{aligned}
\frac{\partial \hat{\mathbf e}_r}{\partial \phi}
=
\sin\theta\,\hat{\mathbf e}_\phi,\quad
\frac{\partial \hat{\mathbf e}_\theta}{\partial \phi}
=
\cos\theta\,\hat{\mathbf e}_\phi,\quad
\frac{\partial \hat{\mathbf e}_\phi}{\partial \phi}
=
-\sin\theta\,\hat{\mathbf e}_r
-
\cos\theta\,\hat{\mathbf e}_\theta
\end{aligned}
$$


### 4. Expanded physical arc-length derivatives

#### 4.1. w.r.t to $$r$$:

From 1, 2, and 3.1:

$$
\frac{\partial \mathbf F}{\partial s_r} =
\frac{\partial \mathbf F}{\partial r}
=
\frac{\partial F_r}{\partial r}\,\hat{\mathbf e}_r
+
\frac{\partial F_\theta}{\partial r}\,\hat{\mathbf e}_\theta
+
\frac{\partial F_\phi}{\partial r}\,\hat{\mathbf e}_\phi
$$


#### 4.2. w.r.t to $$\theta$$:

From 1, 2, and 3.2:

$$
\frac{\partial \mathbf F}{\partial s_\theta} = \frac{1}{r}\left[(\frac{\partial{F_r}}{\partial{\theta}}\mathbf{\hat{e}}_r + \frac{\partial{\mathbf{\hat{e}}_r}}{\partial{\theta}}F_r) + (\frac{\partial{F_{\theta}}}{\partial{\theta}}\mathbf{\hat{e}}_\theta + \frac{\partial{\mathbf{\hat{e}}_\theta}}{\partial{\theta}}F_\theta) + (\frac{\partial{F_{\phi}}}{\partial{\theta}}\mathbf{\hat{e}}_\phi + \frac{\partial{\mathbf{\hat{e}}_\phi}}{\partial{\theta}}F_\phi)\right]
$$


Putting in the basis derivatives


$$
= \frac{1}{r}\left[(\frac{\partial{F_r}}{\partial{\theta}}\mathbf{\hat{e}}_r + \mathbf{\hat{e}}_{\theta}F_r) + 
(\frac{\partial{F_{\theta}}}{\partial{\theta}}\mathbf{\hat{e}}_\theta - \mathbf{\hat{e}}_{r}F_\theta) +
(\frac{\partial{F_{\phi}}}{\partial{\theta}}\mathbf{\hat{e}}_\phi + 0\times F_\phi)\right]
$$


Reordering the terms


$$
= \frac{1}{r}\left[(\frac{\partial{F_r}}{\partial{\theta}}\mathbf{\hat{e}}_r - \mathbf{\hat{e}}_{r}F_\theta) + 
(\frac{\partial{F_{\theta}}}{\partial{\theta}}\mathbf{\hat{e}}_\theta +  \mathbf{\hat{e}}_{\theta}F_r) +
(\frac{\partial{F_{\phi}}}{\partial{\theta}}\mathbf{\hat{e}}_\phi)\right]
$$


Finally


$$
= \frac{1}{r}
\left[(
\frac{\partial F_r}{\partial \theta}
-
F_\theta
)\hat{\mathbf e}_r
+
(\frac{\partial F_\theta}{\partial \theta}
+
F_r)\hat{\mathbf e}_\theta
+
(
\frac{\partial F_\phi}{\partial \theta}
)\hat{\mathbf e}_\phi\right]
$$


#### 4.3. w.r.t to $$\phi$$:

From 1, 2, and 3.3:

$$
\frac{\partial \mathbf F}{\partial s_\phi}=\frac{1}{r\sin\theta}\left[
    
    (\frac{\partial{F_r}}{\partial{\phi}}\mathbf{\hat{e}}_r + \frac{\partial{\mathbf{\hat{e}}_r}}{\partial{\phi}}F_r) +
    
    (\frac{\partial{F_{\theta}}}{\partial{\phi}}\mathbf{\hat{e}}_\theta + \frac{\partial{\mathbf{\hat{e}}_\theta}}{\partial{\phi}}F_\theta) +
    
    (\frac{\partial{F_{\phi}}}{\partial{\phi}}\mathbf{\hat{e}}_\phi + \frac{\partial{\mathbf{\hat{e}}_\phi}}{\partial{\phi}}F_\phi)\right]
$$

$$
=\frac{1}{r\sin\theta}\left[

    (\frac{\partial{F_r}}{\partial{\phi}}\mathbf{\hat{e}}_r + \sin\theta \hat{\mathbf e}_\phi F_r) +

    (\frac{\partial{F_{\theta}}}{\partial{\phi}}\mathbf{\hat{e}}_\theta +  \cos\theta \hat{\mathbf e}_\phi F_\theta) +

    (\frac{\partial{F_{\phi}}}{\partial{\phi}}\mathbf{\hat{e}}_\phi -\sin\theta\,\hat{\mathbf e}_rF_\phi - \cos\theta\,\hat{\mathbf e}_\theta F_\phi)
\right]
$$

$$
=\frac{1}{r\sin\theta}\left[

    (\frac{\partial{F_r}}{\partial{\phi}} -\sin\theta\,F_\phi)\,\mathbf{\hat{e}}_r +

    (\frac{\partial{F_{\theta}}}{\partial{\phi}}  - \cos\theta\, F_\phi)\,\mathbf{\hat{e}}_\theta +

    (\frac{\partial{F_{\phi}}}{\partial{\phi}} + \sin\theta F_r + \cos\theta F_\theta)\,\mathbf{\hat{e}}_\phi
\right]
$$

$$
=\frac{1}{r}\left[

    (\frac{1}{\sin\theta}\frac{\partial{F_r}}{\partial{\phi}} - F_\phi)\,\mathbf{\hat{e}}_r +

    (\frac{1}{\sin\theta}\frac{\partial{F_{\theta}}}{\partial{\phi}}  - \cot\theta\, F_\phi)\,\mathbf{\hat{e}}_\theta +

    (\frac{1}{\sin\theta}\frac{\partial{F_{\phi}}}{\partial{\phi}} + F_r + \cot\theta F_\theta)\,\mathbf{\hat{e}}_\phi
\right]
$$


### 5. Gradient of a vector field $$\boldsymbol{\nabla}\mathbf F$$, (physical, arc-length)

$$
\begin{align}
{
\boldsymbol{\nabla}\mathbf F
=
\begin{pmatrix}
\hat{\mathbf e}_r \cdot \dfrac{\partial \mathbf F}{\partial s_r}
&
\hat{\mathbf e}_r \cdot \dfrac{\partial \mathbf F}{\partial s_\theta}
&
\hat{\mathbf e}_r \cdot \dfrac{\partial \mathbf F}{\partial s_\phi}
\\[6pt]
\hat{\mathbf e}_\theta \cdot \dfrac{\partial \mathbf F}{\partial s_r}
&
\hat{\mathbf e}_\theta \cdot \dfrac{\partial \mathbf F}{\partial s_\theta}
&
\hat{\mathbf e}_\theta \cdot \dfrac{\partial \mathbf F}{\partial s_\phi}
\\[6pt]
\hat{\mathbf e}_\phi \cdot \dfrac{\partial \mathbf F}{\partial s_r}
&
\hat{\mathbf e}_\phi \cdot \dfrac{\partial \mathbf F}{\partial s_\theta}
&
\hat{\mathbf e}_\phi \cdot \dfrac{\partial \mathbf F}{\partial s_\phi}
\end{pmatrix}\,,\quad \text{i.e.,}\quad
(\boldsymbol{\nabla}\mathbf F)_{ij} = \hat{\mathbf e}_i \cdot\frac{\partial \mathbf{F}}{\partial s_j}
}
\end{align}
$$

yields the Jacobian matrix:

$$
\boldsymbol{\nabla}\mathbf F
=
\begin{pmatrix}
\dfrac{\partial F_r}{\partial r}
&
\dfrac{1}{r}\dfrac{\partial F_r}{\partial \theta}
-
\dfrac{F_\theta}{r}
&
\dfrac{1}{r\sin\theta}\dfrac{\partial F_r}{\partial \phi}
-
\dfrac{F_\phi}{r}
\\[10pt]
\dfrac{\partial F_\theta}{\partial r}
&
\dfrac{1}{r}\dfrac{\partial F_\theta}{\partial \theta}
+
\dfrac{F_r}{r}
&
\dfrac{1}{r\sin\theta}\dfrac{\partial F_\theta}{\partial \phi}
-
\dfrac{F_\phi\cot\theta}{r}
\\[10pt]
\dfrac{\partial F_\phi}{\partial r}
&
\dfrac{1}{r}\dfrac{\partial F_\phi}{\partial \theta}
&
\dfrac{1}{r\sin\theta}\dfrac{\partial F_\phi}{\partial \phi}
+
\dfrac{F_r}{r}
+
\dfrac{F_\theta\cot\theta}{r}
\end{pmatrix}
$$
