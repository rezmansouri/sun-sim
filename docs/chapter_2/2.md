---
layout: default
---

## Equation 6 as a loss function

The original equation:

$$
\rho\left(\frac{\partial {v}}{\partial t}+{v} \cdot \nabla {v}\right)=\frac{1}{c} {J} \times {B}-\nabla P+\rho {g}+\nabla \cdot(\nu \rho \nabla {v})
$$

For static approximation, $$\frac{\partial {v}}{\partial t} = -\Omega_{\text{rot}}\frac{\partial{v}}{\partial \phi}$$ yields:

$$
\rho\left(-\Omega_{\text{rot}}\frac{\partial{v}}{\partial \phi}+{v} \cdot \nabla {v}\right)=\frac{1}{c} {J} \times {B}-\nabla P+\rho {g}+\nabla \cdot(\nu \rho \nabla {v})
$$


## Spherical math 101

Let $$F(r, \theta, \phi) = F_r\mathbf{\hat{e}}_r + F_{\theta}\mathbf{\hat{e}}_{\theta} + F_{\phi}\mathbf{\hat{e}}_{\phi}$$ be our spherical field, where $$F_i$$ is the vector field in each direction and $$\mathbf{\hat{e}}_i$$ is the unit vector for each direction.

### 1. Product rule:

We know that for $$w(x,y)=u(x,y)v(x,y)$$, $$\frac{\partial{w}}{\partial{x}}=\frac{\partial{u}}{\partial{x}}v + \frac{\partial{v}}{\partial{x}}u$$.

In a spherical system:

$$
\frac{\partial{F}}{\partial{q}}=(\frac{\partial{F_r}}{\partial{q}}\mathbf{\hat{e}}_r + \frac{\partial{\mathbf{\hat{e}}_r}}{\partial{q}}F_r) + (\frac{\partial{F_{\theta}}}{\partial{q}}\mathbf{\hat{e}}_\theta + \frac{\partial{\mathbf{\hat{e}}_\theta}}{\partial{q}}F_\theta) + (\frac{\partial{F_{\phi}}}{\partial{q}}\mathbf{\hat{e}}_\phi + \frac{\partial{\mathbf{\hat{e}}_\phi}}{\partial{q}}F_\phi)
$$


### 2. Physical, arc-length derivatives - <a href="https://jdriven.com/blog/uploads/2025/12/Gradient_in_spherical_coordinates.pdf?utm_source=chatgpt.com">reference</a>

Some spherical scaling factors are incorporated.

$$
\begin{aligned}
\frac{\partial}{\partial{s_r}} = \frac{\partial}{\partial{r}}, \quad\frac{\partial}{\partial{s_\theta}} = \frac{1}{r}\frac{\partial}{\partial{\theta}},\quad\frac{\partial}{\partial{s_\phi}} = \frac{1}{r\text{sin}\theta}\frac{\partial}{\partial{\phi}}
\end{aligned}
$$


### 3. Unit vector derivatives - <a href="https://youtu.be/JQl9L1CiTZs?si=qtHDyPI1pW6Lv60N">reference</a>

#### 3.1. w.r.t $$r$$:
$$
\frac{\partial \hat{\mathbf e}_r}{\partial r}
=
\frac{\partial \hat{\mathbf e}_\theta}{\partial r}
=
\frac{\partial \hat{\mathbf e}_\phi}{\partial r}
=
0
$$

#### 3.2. w.r.t $$\theta$$:
$$
\begin{aligned}
\frac{\partial \hat{\mathbf e}_r}{\partial \theta} = \hat{\mathbf e}_\theta,\quad \frac{\partial \hat{\mathbf e}_\theta}{\partial \theta} = -\hat{\mathbf e}_r,\quad\frac{\partial \hat{\mathbf e}_\phi}{\partial \theta} = 0
\end{aligned}
$$


#### 3.3. w.r.t $$\phi$$:
$$
\begin{aligned}
\frac{\partial \hat{\mathbf e}_r}{\partial \phi}
=
\sin\theta\,\hat{\mathbf e}_\phi,\quad
\frac{\partial \hat{\mathbf e}_\theta}{\partial \phi}
=
\cos\theta\,\hat{\mathbf e}_\phi,\quad
\frac{\partial \hat{\mathbf e}_\phi}{\partial \phi}
=
-\sin\theta\,\hat{\mathbf e}_r
-
\cos\theta\,\hat{\mathbf e}_\theta
\end{aligned}
$$


### 4. Expanded physical arc-length derivatives

#### 4.1. w.r.t to $$r$$:

From 1, 2, and 3.1:

$$
\frac{\partial \mathbf F}{\partial s_r} =
\frac{\partial \mathbf F}{\partial r}
=
\frac{\partial F_r}{\partial r}\,\hat{\mathbf e}_r
+
\frac{\partial F_\theta}{\partial r}\,\hat{\mathbf e}_\theta
+
\frac{\partial F_\phi}{\partial r}\,\hat{\mathbf e}_\phi
$$


#### 4.2. w.r.t to $$\theta$$:

From 1, 2, and 3.2:

$$
\frac{\partial \mathbf F}{\partial s_\theta} = \frac{1}{r}\left[(\frac{\partial{F_r}}{\partial{\theta}}\mathbf{\hat{e}}_r + \frac{\partial{\mathbf{\hat{e}}_r}}{\partial{\theta}}F_r) + (\frac{\partial{F_{\theta}}}{\partial{\theta}}\mathbf{\hat{e}}_\theta + \frac{\partial{\mathbf{\hat{e}}_\theta}}{\partial{\theta}}F_\theta) + (\frac{\partial{F_{\phi}}}{\partial{\theta}}\mathbf{\hat{e}}_\phi + \frac{\partial{\mathbf{\hat{e}}_\phi}}{\partial{\theta}}F_\phi)\right]
$$


Putting in the basis derivatives


$$
= \frac{1}{r}\left[(\frac{\partial{F_r}}{\partial{\theta}}\mathbf{\hat{e}}_r + \mathbf{\hat{e}}_{\theta}F_r) + 
(\frac{\partial{F_{\theta}}}{\partial{\theta}}\mathbf{\hat{e}}_\theta - \mathbf{\hat{e}}_{r}F_\theta) +
(\frac{\partial{F_{\phi}}}{\partial{\theta}}\mathbf{\hat{e}}_\phi + 0\times F_\phi)\right]
$$


Reordering the terms


$$
= \frac{1}{r}\left[(\frac{\partial{F_r}}{\partial{\theta}}\mathbf{\hat{e}}_r - \mathbf{\hat{e}}_{r}F_\theta) + 
(\frac{\partial{F_{\theta}}}{\partial{\theta}}\mathbf{\hat{e}}_\theta +  \mathbf{\hat{e}}_{\theta}F_r) +
(\frac{\partial{F_{\phi}}}{\partial{\theta}}\mathbf{\hat{e}}_\phi)\right]
$$


Finally


$$
= \frac{1}{r}
\left[(
\frac{\partial F_r}{\partial \theta}
-
F_\theta
)\hat{\mathbf e}_r
+
(\frac{\partial F_\theta}{\partial \theta}
+
F_r)\hat{\mathbf e}_\theta
+
(
\frac{\partial F_\phi}{\partial \theta}
)\hat{\mathbf e}_\phi\right]
$$


#### 4.3. w.r.t to $$\phi$$:

From 1, 2, and 3.3:

$$
\frac{\partial \mathbf F}{\partial s_\phi}=\frac{1}{r\sin\theta}\left[
    
    (\frac{\partial{F_r}}{\partial{\phi}}\mathbf{\hat{e}}_r + \frac{\partial{\mathbf{\hat{e}}_r}}{\partial{\phi}}F_r) +
    
    (\frac{\partial{F_{\theta}}}{\partial{\phi}}\mathbf{\hat{e}}_\theta + \frac{\partial{\mathbf{\hat{e}}_\theta}}{\partial{\phi}}F_\theta) +
    
    (\frac{\partial{F_{\phi}}}{\partial{\phi}}\mathbf{\hat{e}}_\phi + \frac{\partial{\mathbf{\hat{e}}_\phi}}{\partial{\phi}}F_\phi)\right]
$$

$$
=\frac{1}{r\sin\theta}\left[

    (\frac{\partial{F_r}}{\partial{\phi}}\mathbf{\hat{e}}_r + \sin\theta \hat{\mathbf e}_\phi F_r) +

    (\frac{\partial{F_{\theta}}}{\partial{\phi}}\mathbf{\hat{e}}_\theta +  \cos\theta \hat{\mathbf e}_\phi F_\theta) +

    (\frac{\partial{F_{\phi}}}{\partial{\phi}}\mathbf{\hat{e}}_\phi -\sin\theta\,\hat{\mathbf e}_rF_\phi - \cos\theta\,\hat{\mathbf e}_\theta F_\phi)
\right]
$$

$$
=\frac{1}{r\sin\theta}\left[

    (\frac{\partial{F_r}}{\partial{\phi}} -\sin\theta\,F_\phi)\,\mathbf{\hat{e}}_r +

    (\frac{\partial{F_{\theta}}}{\partial{\phi}}  - \cos\theta\, F_\phi)\,\mathbf{\hat{e}}_\theta +

    (\frac{\partial{F_{\phi}}}{\partial{\phi}} + \sin\theta F_r + \cos\theta F_\theta)\,\mathbf{\hat{e}}_\phi
\right]
$$

$$
=\frac{1}{r}\left[

    (\frac{1}{\sin\theta}\frac{\partial{F_r}}{\partial{\phi}} - F_\phi)\,\mathbf{\hat{e}}_r +

    (\frac{1}{\sin\theta}\frac{\partial{F_{\theta}}}{\partial{\phi}}  - \cot\theta\, F_\phi)\,\mathbf{\hat{e}}_\theta +

    (\frac{1}{\sin\theta}\frac{\partial{F_{\phi}}}{\partial{\phi}} + F_r + \cot\theta F_\theta)\,\mathbf{\hat{e}}_\phi
\right]
$$


### 5. Gradient matrix of a vector field $$\boldsymbol{\nabla}\mathbf F$$, (physical, arc-length) like $$v$$

$$
\begin{align}
{
\boldsymbol{\nabla}\mathbf F
=
\begin{pmatrix}
\hat{\mathbf e}_r \cdot \dfrac{\partial \mathbf F}{\partial s_r}
&
\hat{\mathbf e}_r \cdot \dfrac{\partial \mathbf F}{\partial s_\theta}
&
\hat{\mathbf e}_r \cdot \dfrac{\partial \mathbf F}{\partial s_\phi}
\\[6pt]
\hat{\mathbf e}_\theta \cdot \dfrac{\partial \mathbf F}{\partial s_r}
&
\hat{\mathbf e}_\theta \cdot \dfrac{\partial \mathbf F}{\partial s_\theta}
&
\hat{\mathbf e}_\theta \cdot \dfrac{\partial \mathbf F}{\partial s_\phi}
\\[6pt]
\hat{\mathbf e}_\phi \cdot \dfrac{\partial \mathbf F}{\partial s_r}
&
\hat{\mathbf e}_\phi \cdot \dfrac{\partial \mathbf F}{\partial s_\theta}
&
\hat{\mathbf e}_\phi \cdot \dfrac{\partial \mathbf F}{\partial s_\phi}
\end{pmatrix}\,,\quad \text{i.e.,}\quad
(\boldsymbol{\nabla}\mathbf F)_{ij} = \hat{\mathbf e}_i \cdot\frac{\partial \mathbf{F}}{\partial s_j}
}
\end{align}
$$

yields the Jacobian matrix:

$$
\boldsymbol{\nabla}\mathbf F
=
\begin{pmatrix}
\dfrac{\partial F_r}{\partial r}
&
\dfrac{1}{r}\dfrac{\partial F_r}{\partial \theta}
-
\dfrac{F_\theta}{r}
&
\dfrac{1}{r\sin\theta}\dfrac{\partial F_r}{\partial \phi}
-
\dfrac{F_\phi}{r}
\\[10pt]
\dfrac{\partial F_\theta}{\partial r}
&
\dfrac{1}{r}\dfrac{\partial F_\theta}{\partial \theta}
+
\dfrac{F_r}{r}
&
\dfrac{1}{r\sin\theta}\dfrac{\partial F_\theta}{\partial \phi}
-
\dfrac{F_\phi\cot\theta}{r}
\\[10pt]
\dfrac{\partial F_\phi}{\partial r}
&
\dfrac{1}{r}\dfrac{\partial F_\phi}{\partial \theta}
&
\dfrac{1}{r\sin\theta}\dfrac{\partial F_\phi}{\partial \phi}
+
\dfrac{F_r}{r}
+
\dfrac{F_\theta\cot\theta}{r}
\end{pmatrix}
$$


### 6. Advective (convective) derivative $$\mathbf F\cdot\nabla \mathbf F$$ or $$(\mathbf F.\nabla)\mathbf F$$ of a vector field  like $$v$$

$$
\mathbf F \cdot \boldsymbol{\nabla} \mathbf F
\;\equiv\;
(\mathbf F \cdot \boldsymbol{\nabla})\mathbf F
$$

It's a vector-matrix multiplication, giving a vector.

$$
(\mathbf F \cdot \boldsymbol{\nabla})\mathbf F
=
(\boldsymbol{\nabla}\mathbf F)
\begin{pmatrix}
F_r\\
F_\theta\\
F_\phi
\end{pmatrix}
$$

Assuming

$$
\boldsymbol{\nabla}\mathbf F
=
\begin{pmatrix}
A_{rr} & A_{r\theta} & A_{r\phi}\\
A_{\theta r} & A_{\theta\theta} & A_{\theta\phi}\\
A_{\phi r} & A_{\phi\theta} & A_{\phi\phi}
\end{pmatrix}
$$

Then

$$
(\mathbf F \cdot \boldsymbol{\nabla})\mathbf F
=
\begin{pmatrix}
A_{rr}F_r + A_{r\theta}F_\theta + A_{r\phi}F_\phi\\
A_{\theta r}F_r + A_{\theta\theta}F_\theta + A_{\theta\phi}F_\phi\\
A_{\phi r}F_r + A_{\phi\theta}F_\theta + A_{\phi\phi}F_\phi
\end{pmatrix}
$$

It has 3 components:

- First row in the matrix above is the r-component
- Second, theta
- Third, phi

$$
(\mathbf F\cdot\boldsymbol{\nabla})\mathbf F
=
\big[(\mathbf F\cdot\boldsymbol{\nabla})\mathbf F\big]_r\,\hat{\mathbf e}_r
+
\big[(\mathbf F\cdot\boldsymbol{\nabla})\mathbf F\big]_\theta\,\hat{\mathbf e}_\theta
+
\big[(\mathbf F\cdot\boldsymbol{\nabla})\mathbf F\big]_\phi\,\hat{\mathbf e}_\phi
$$


#### 6.1. The $$r$$ component:

From 5:

$$
\big[(\mathbf F\cdot\boldsymbol{\nabla})\mathbf F\big]_r
=
F_r\,\frac{\partial F_r}{\partial r}
+
F_\theta\left(
\frac{1}{r}\frac{\partial F_r}{\partial \theta}
-
\frac{F_\theta}{r}
\right)
+
F_\phi\left(
\frac{1}{r\sin\theta}\frac{\partial F_r}{\partial \phi}
-
\frac{F_\phi}{r}
\right)
$$

Expanded

$$
\big[(\mathbf F\cdot\boldsymbol{\nabla})\mathbf F\big]_r
=
F_r\,\frac{\partial F_r}{\partial r}
+
\frac{F_\theta}{r}\frac{\partial F_r}{\partial \theta}
+
\frac{F_\phi}{r\sin\theta}\frac{\partial F_r}{\partial \phi}
-
\frac{F_\theta^2+F_\phi^2}{r}
$$


#### 6.2. The $$\theta$$ component:

From 5:

$$
\big[(\mathbf F\cdot\boldsymbol{\nabla})\mathbf F\big]_\theta
=
F_r\,\frac{\partial F_\theta}{\partial r}
+
F_\theta\left(
\frac{1}{r}\frac{\partial F_\theta}{\partial \theta}
+
\frac{F_r}{r}
\right)
+
F_\phi\left(
\frac{1}{r\sin\theta}\frac{\partial F_\theta}{\partial \phi}
-
\frac{F_\phi\cot\theta}{r}
\right)
$$

Expanded:

$$
\big[(\mathbf F\cdot\boldsymbol{\nabla})\mathbf F\big]_\theta
=
F_r\,\frac{\partial F_\theta}{\partial r}
+
\frac{F_\theta}{r}\frac{\partial F_\theta}{\partial \theta}
+
\frac{F_\phi}{r\sin\theta}\frac{\partial F_\theta}{\partial \phi}
+
\frac{F_rF_\theta}{r}
-
\frac{F_\phi^2\cot\theta}{r}
$$


#### 6.3. The $$\phi$$ component:

From 5

$$
\big[(\mathbf F\cdot\boldsymbol{\nabla})\mathbf F\big]_\phi
=
F_r\,\frac{\partial F_\phi}{\partial r}
+
F_\theta\left(
\frac{1}{r}\frac{\partial F_\phi}{\partial \theta}
\right)
+
F_\phi\left(
\frac{1}{r\sin\theta}\frac{\partial F_\phi}{\partial \phi}
+
\frac{F_r}{r}
+
\frac{F_\theta\cot\theta}{r}
\right)
$$

Expanded

$$
\big[(\mathbf F\cdot\boldsymbol{\nabla})\mathbf F\big]_\phi
=
F_r\,\frac{\partial F_\phi}{\partial r}
+
\frac{F_\theta}{r}\frac{\partial F_\phi}{\partial \theta}
+
\frac{F_\phi}{r\sin\theta}\frac{\partial F_\phi}{\partial \phi}
+
\frac{F_rF_\phi}{r}
+
\frac{F_\theta F_\phi\cot\theta}{r}
$$


### 7. Gradient of a scalar ($$\nabla f$$) like $$P$$ or $$\rho$$

$$
\boldsymbol{\nabla} f
=
\hat{\mathbf e}_r\,\frac{\partial f}{\partial r}
+
\hat{\mathbf e}_\theta\,\frac{1}{r}\frac{\partial f}{\partial \theta}
+
\hat{\mathbf e}_\phi\,\frac{1}{r\sin\theta}\frac{\partial f}{\partial \phi}
$$

The result is a vector with $$r,\theta,\phi$$ components.


### 8. Divergence of a vector field $$ \boldsymbol{\nabla}\cdot\mathbf F$$ like $$v$$

Divergence is the trace of the gradient tensor.

$$
\boldsymbol{\nabla}\cdot\mathbf F
=
\hat{\mathbf e}_r\cdot\frac{\partial \mathbf F}{\partial s_r}
+
\hat{\mathbf e}_\theta\cdot\frac{\partial \mathbf F}{\partial s_\theta}
+
\hat{\mathbf e}_\phi\cdot\frac{\partial \mathbf F}{\partial s_\phi}
$$

#### 8.1. Radial term $$\hat{\mathbf e}_r\cdot\frac{\partial \mathbf F}{\partial s_r}$$

$$
\frac{\partial \mathbf F}{\partial s_r}
=
\frac{\partial \mathbf F}{\partial r}
=
\frac{\partial F_r}{\partial r}\hat{\mathbf e}_r
+
\frac{\partial F_\theta}{\partial r}\hat{\mathbf e}_\theta
+
\frac{\partial F_\phi}{\partial r}\hat{\mathbf e}_\phi
$$

Dot with $$\mathbf{\hat{e}_r}$$

$$
\hat{\mathbf e}_r\cdot\frac{\partial \mathbf F}{\partial s_r}
=
\frac{\partial F_r}{\partial r}
$$


#### 8.2. $$\theta$$ term $$\hat{\mathbf e}_\theta\cdot\frac{\partial \mathbf F}{\partial s_\theta}$$


$$
\frac{\partial \mathbf F}{\partial s_\theta}
=
\left(\frac{1}{r}\frac{\partial F_r}{\partial \theta}-\frac{F_\theta}{r}\right)\hat{\mathbf e}_r
+
\left(\frac{1}{r}\frac{\partial F_\theta}{\partial \theta}+\frac{F_r}{r}\right)\hat{\mathbf e}_\theta
+
\left(\frac{1}{r}\frac{\partial F_\phi}{\partial \theta}\right)\hat{\mathbf e}_\phi
$$


Dot with $$\mathbf{\hat{e}_\theta}$$

$$
\hat{\mathbf e}_\theta\cdot\frac{\partial \mathbf F}{\partial s_\theta}
=
\frac{1}{r}\frac{\partial F_\theta}{\partial \theta}
+
\frac{F_r}{r}
$$


#### 8.3. $$\phi$$ term $$\hat{\mathbf e}_\phi\cdot\frac{\partial \mathbf F}{\partial s_\phi}$$

$$
\frac{\partial \mathbf F}{\partial s_\phi}
=\frac{1}{r}\left[

    (\frac{1}{\sin\theta}\frac{\partial{F_r}}{\partial{\phi}} - F_\phi)\,\mathbf{\hat{e}}_r +

    (\frac{1}{\sin\theta}\frac{\partial{F_{\theta}}}{\partial{\phi}}  - \cot\theta\, F_\phi)\,\mathbf{\hat{e}}_\theta +

    (\frac{1}{\sin\theta}\frac{\partial{F_{\phi}}}{\partial{\phi}} + F_r + \cot\theta F_\theta)\,\mathbf{\hat{e}}_\phi
\right]
$$

Dot with $$\mathbf{\hat{e}_\phi}$$:

$$
\hat{\mathbf e}_\phi\cdot\frac{\partial \mathbf F}{\partial s_\phi}
=
\frac{1}{r\sin\theta}\frac{\partial F_\phi}{\partial \phi}
+
\frac{F_r}{r}
+
\frac{F_\theta\cot\theta}{r}
$$


Adding 8.1, 8.2, and 8.3:

$$
\boldsymbol{\nabla}\cdot\mathbf F
=
\frac{\partial F_r}{\partial r}
+
\left(
\frac{1}{r}\frac{\partial F_\theta}{\partial \theta}
+
\frac{F_r}{r}
\right)
+
\left(
\frac{1}{r\sin\theta}\frac{\partial F_\phi}{\partial \phi}
+
\frac{F_r}{r}
+
\frac{F_\theta\cot\theta}{r}
\right)
$$

Simplifying

$$
\boldsymbol{\nabla}\cdot\mathbf F
=
\frac{\partial F_r}{\partial r}
+
\frac{2F_r}{r}
+
\frac{1}{r}\frac{\partial F_\theta}{\partial \theta}
+
\frac{F_\theta\cot\theta}{r}
+
\frac{1}{r\sin\theta}\frac{\partial F_\phi}{\partial \phi}
$$

Or in another form rewritten using the product rule on $$r^2F_r$$ and $$\sin\theta F_\theta$$

$$
\boldsymbol{\nabla}\cdot\mathbf F
=
\frac{1}{r^2}\frac{\partial}{\partial r}\left(r^2F_r\right)
+
\frac{1}{r\sin\theta}\frac{\partial}{\partial \theta}\left(\sin\theta\,F_\theta\right)
+
\frac{1}{r\sin\theta}\frac{\partial F_\phi}{\partial \phi}
$$

The result is a **scalar**.

### 9. Cross product of two vector fields like $$J\times B$$

$$
\mathbf J \times \mathbf B
=
\left(J_\theta B_\phi - J_\phi B_\theta\right)\hat{\mathbf e}_r
+
\left(J_\phi B_r - J_r B_\phi\right)\hat{\mathbf e}_\theta
+
\left(J_r B_\theta - J_\theta B_r\right)\hat{\mathbf e}_\phi
$$

The result is one vector with $$r, \theta, \phi$$ components.


### 10. Divergence of the gradient matrix of a vector field ($$\nabla\cdot(\nabla\mathbf{F})$$) as in $$\nabla \cdot(\nu \rho \nabla {v})$$ also called vector Laplacian-like

From 5, we have $$\nabla\mathbf{F}$$.

Divergence of a matrix is the vector of divergence applied to each row:

$$
\boldsymbol{\nabla}\cdot(\boldsymbol{\nabla}\mathbf F)
=
\begin{pmatrix}
\boldsymbol{\nabla}\cdot\left(A_{rr},\,A_{r\theta},\,A_{r\phi}\right)\\[6pt]
\boldsymbol{\nabla}\cdot\left(A_{\theta r},\,A_{\theta\theta},\,A_{\theta\phi}\right)\\[6pt]
\boldsymbol{\nabla}\cdot\left(A_{\phi r},\,A_{\phi\theta},\,A_{\phi\phi}\right)
\end{pmatrix}
$$


#### 10.1. $$r$$ component

$$
(\boldsymbol{\nabla}\cdot(\boldsymbol{\nabla}\mathbf F))_r
=
\frac{1}{r^2}\frac{\partial}{\partial r}
\!\left(
r^2\,\frac{\partial F_r}{\partial r}
\right)
+
\frac{1}{r\sin\theta}\frac{\partial}{\partial\theta}
\!\left(
\sin\theta
\left[
\frac{1}{r}\frac{\partial F_r}{\partial\theta}
-
\frac{F_\theta}{r}
\right]
\right)
+
\frac{1}{r\sin\theta}\frac{\partial}{\partial\phi}
\!\left(
\frac{1}{r\sin\theta}\frac{\partial F_r}{\partial\phi}
-
\frac{F_\phi}{r}
\right)
$$

Expanding

$$
=\frac{\partial^2 F_r}{\partial r^2}
+
\frac{2}{r}\frac{\partial F_r}{\partial r}
+
\frac{1}{r^2}\frac{\partial^2 F_r}{\partial \theta^2}
+
\frac{\cot\theta}{r^2}\frac{\partial F_r}{\partial \theta}
-
\frac{1}{r^2}\frac{\partial F_\theta}{\partial \theta}
-
\frac{\cot\theta}{r^2}F_\theta
+
\frac{1}{r^2\sin^2\theta}\frac{\partial^2 F_r}{\partial \phi^2}
-
\frac{1}{r^2\sin\theta}\frac{\partial F_\phi}{\partial \phi}
$$

#### 10.2. $$\theta$$ component

$$
(\boldsymbol{\nabla}\cdot(\boldsymbol{\nabla}\mathbf F))_\theta
=
\frac{1}{r^2}\frac{\partial}{\partial r}
\!\left(
r^2\,\frac{\partial F_\theta}{\partial r}
\right)
+
\frac{1}{r\sin\theta}\frac{\partial}{\partial\theta}
\!\left(
\sin\theta
\left[
\frac{1}{r}\frac{\partial F_\theta}{\partial\theta}
+
\frac{F_r}{r}
\right]
\right)
+
\frac{1}{r\sin\theta}\frac{\partial}{\partial\phi}
\!\left(
\frac{1}{r\sin\theta}\frac{\partial F_\theta}{\partial\phi}
-
\frac{F_\phi\cot\theta}{r}
\right)
$$

Expanding

$$
=\frac{\partial^2 F_\theta}{\partial r^2}
+
\frac{2}{r}\frac{\partial F_\theta}{\partial r}
+
\frac{1}{r^2}\frac{\partial^2 F_\theta}{\partial \theta^2}
+
\frac{\cot\theta}{r^2}\frac{\partial F_\theta}{\partial \theta}
+
\frac{1}{r^2}\frac{\partial F_r}{\partial \theta}
+
\frac{\cot\theta}{r^2}F_r
+
\frac{1}{r^2\sin^2\theta}\frac{\partial^2 F_\theta}{\partial \phi^2}
-
\frac{\cot\theta}{r^2\sin\theta}\frac{\partial F_\phi}{\partial \phi}
$$


#### 10.3. $$\phi$$ component

$$
(\boldsymbol{\nabla}\cdot(\boldsymbol{\nabla}\mathbf F))_\phi
=
\frac{1}{r^2}\frac{\partial}{\partial r}
\!\left(
r^2\,\frac{\partial F_\phi}{\partial r}
\right)
+
\frac{1}{r\sin\theta}\frac{\partial}{\partial\theta}
\!\left(
\sin\theta
\left[
\frac{1}{r}\frac{\partial F_\phi}{\partial\theta}
\right]
\right)
+
\frac{1}{r\sin\theta}\frac{\partial}{\partial\phi}
\!\left(
\frac{1}{r\sin\theta}\frac{\partial F_\phi}{\partial\phi}
+
\frac{F_r}{r}
+
\frac{F_\theta\cot\theta}{r}
\right)
$$

Expanding

$$
=\frac{\partial^2 F_\phi}{\partial r^2}
+
\frac{2}{r}\frac{\partial F_\phi}{\partial r}
+
\frac{1}{r^2}\frac{\partial^2 F_\phi}{\partial \theta^2}
+
\frac{\cot\theta}{r^2}\frac{\partial F_\phi}{\partial \theta}
+
\frac{1}{r^2\sin^2\theta}\frac{\partial^3 F_\phi}{\partial \phi^3}
+
\frac{1}{r^2\sin\theta}\frac{\partial F_r}{\partial \phi}
+
\frac{\cot\theta}{r^2\sin\theta}\frac{\partial F_\theta}{\partial \phi}
$$


The result is a **vector**.



## Shape analysis for Eq. 6

**Grid:**  
$$
G = (N_r, N_\theta, N_\phi) = (140, 110, 128)
$$

**Specific terms:**  
- Vector fields (unit spherical basis):  
$$
\mathbf v,\ \mathbf J,\ \mathbf B \;\Rightarrow\; (v_r,v_\theta,v_\phi),\ (J_r,J_\theta,J_\phi),\ (B_r,B_\theta,B_\phi)
$$
Each component has shape $$G$$, so vectors have shape $$3\times G$$.  

- Scalar fields:  
$$
\rho,\ P,\ g \;\Rightarrow\; \text{shape } G
$$

- Constants:  
$$
\Omega_{\text{rot}},\ \nu,\ c \;\Rightarrow\; \text{scalars}
$$

---

**Momentum equation:**
$$
\rho\left(
-\Omega_{\text{rot}}\frac{\partial \mathbf v}{\partial \phi}
+
(\mathbf v\cdot\nabla)\mathbf v
\right)
=
\frac{1}{c}\,\mathbf J\times\mathbf B
-
\nabla P
+
\rho\,\mathbf g
+
\nabla\cdot(\nu\rho\nabla\mathbf v)
$$

---

**Term-by-term (object → shape):**

- $$\frac{\partial \mathbf v}{\partial \phi}$$ → vector → $$3\times G$$  
- $$-\Omega_{\text{rot}}\frac{\partial \mathbf v}{\partial \phi}$$ → vector → $$3\times G$$  
- $$(\mathbf v\cdot\nabla)\mathbf v$$ → vector → $$3\times G$$  
- $$\rho(\cdots)$$ → vector → $$3\times G$$  

- $$\frac{1}{c}\mathbf J\times\mathbf B$$ → vector → $$3\times G$$  
- $$\nabla P$$ → vector → $$3\times G$$  
- $$\rho\,\mathbf g$$ → vector → $$3\times G$$  
- $$\nabla\cdot(\nu\rho\nabla\mathbf v)$$ → vector → $$3\times G$$  

---

**Sides of the equation:**
$$
\text{LHS} \;\Rightarrow\; \text{vector field of shape } 3\times G
$$
$$
\text{RHS} \;\Rightarrow\; \text{vector field of shape } 3\times G
$$

---

**Residual (for PDE enforcement / training):**
$$
\mathbf R
=
\rho\left(
-\Omega_{\text{rot}}\frac{\partial \mathbf v}{\partial \phi}
+
(\mathbf v\cdot\nabla)\mathbf v
\right)
-
\left(
\frac{1}{c}\mathbf J\times\mathbf B
-
\nabla P
+
\rho\,\mathbf g
+
\nabla\cdot(\nu\rho\nabla\mathbf v)
\right)
$$

- $$\mathbf R$$ → vector field → $$3\times G$$

---

## Expanded residuals for each component

$$
R_r \;=\;
\rho\left[
-\Omega_{\mathrm{rot}}\frac{\partial v_r}{\partial \phi}
+
v_r\frac{\partial v_r}{\partial r}
+\frac{v_\theta}{r}\frac{\partial v_r}{\partial \theta}
+\frac{v_\phi}{r\sin\theta}\frac{\partial v_r}{\partial \phi}
-\frac{v_\theta^2+v_\phi^2}{r}
\right]
-\frac{1}{c}\left(J_\theta B_\phi - J_\phi B_\theta\right)
+\frac{\partial P}{\partial r}
-\rho\,g
-\left[\boldsymbol{\nabla}\cdot(\nu\rho\,\boldsymbol{\nabla}\mathbf v)\right]_r
$$

And

$$
R_\theta \;=\;
\rho\left[
-\Omega_{\mathrm{rot}}\frac{\partial v_\theta}{\partial \phi}
+
v_r\frac{\partial v_\theta}{\partial r}
+\frac{v_\theta}{r}\frac{\partial v_\theta}{\partial \theta}
+\frac{v_\phi}{r\sin\theta}\frac{\partial v_\theta}{\partial \phi}
+\frac{v_r v_\theta}{r}
-\frac{v_\phi^2\cot\theta}{r}
\right]
-\frac{1}{c}\left(J_\phi B_r - J_r B_\phi\right)
+\frac{1}{r}\frac{\partial P}{\partial \theta}
-\rho\,g
-\left[\boldsymbol{\nabla}\cdot(\nu\rho\,\boldsymbol{\nabla}\mathbf v)\right]_\theta
$$


And

$$
R_\phi \;=\;
\rho\left[
-\Omega_{\mathrm{rot}}\frac{\partial v_\phi}{\partial \phi}
+
v_r\frac{\partial v_\phi}{\partial r}
+\frac{v_\theta}{r}\frac{\partial v_\phi}{\partial \theta}
+\frac{v_\phi}{r\sin\theta}\frac{\partial v_\phi}{\partial \phi}
+\frac{v_r v_\phi}{r}
+\frac{v_\theta v_\phi\cot\theta}{r}
\right]
-\frac{1}{c}\left(J_r B_\theta - J_\theta B_r\right)
+\frac{1}{r\sin\theta}\frac{\partial P}{\partial \phi}
-\rho\,g_\phi
-\left[\boldsymbol{\nabla}\cdot(\nu\rho\,\boldsymbol{\nabla}\mathbf v)\right]_\phi
$$


Fully expanded viscous terms:

$$
\begin{aligned}
\left[\boldsymbol{\nabla}\cdot(\nu\rho\,\boldsymbol{\nabla}\mathbf v)\right]_r
={}&\nu\Bigg[
\rho\,\frac{\partial^2 v_r}{\partial r^2}
+
\left(\frac{\partial \rho}{\partial r}+\frac{2\rho}{r}\right)\frac{\partial v_r}{\partial r}
\\
&\quad+
\frac{\rho}{r^2}\frac{\partial^2 v_r}{\partial \theta^2}
+
\frac{1}{r^2}\left(\frac{\partial \rho}{\partial \theta}+\rho\cot\theta\right)\frac{\partial v_r}{\partial \theta}
-
\frac{\rho}{r^2}\frac{\partial v_\theta}{\partial \theta}
-
\frac{1}{r^2}\left(\frac{\partial \rho}{\partial \theta}+\rho\cot\theta\right)v_\theta
\\
&\quad+
\frac{\rho}{r^2\sin^2\theta}\frac{\partial^2 v_r}{\partial \phi^2}
+
\frac{1}{r^2\sin^2\theta}\frac{\partial \rho}{\partial \phi}\frac{\partial v_r}{\partial \phi}
-
\frac{\rho}{r^2\sin\theta}\frac{\partial v_\phi}{\partial \phi}
-
\frac{1}{r^2\sin\theta}\frac{\partial \rho}{\partial \phi}\,v_\phi
\Bigg].
\end{aligned}
$$

And 

$$
\begin{aligned}
\left[\boldsymbol{\nabla}\cdot(\nu\rho\,\boldsymbol{\nabla}\mathbf v)\right]_\theta
={}&\nu\Bigg[
\rho\,\frac{\partial^2 v_\theta}{\partial r^2}
+
\left(\frac{\partial \rho}{\partial r}+\frac{2\rho}{r}\right)\frac{\partial v_\theta}{\partial r}
\\
&\quad+
\frac{\rho}{r^2}\frac{\partial^2 v_\theta}{\partial \theta^2}
+
\frac{1}{r^2}\left(\frac{\partial \rho}{\partial \theta}+\rho\cot\theta\right)\frac{\partial v_\theta}{\partial \theta}
+
\frac{\rho}{r^2}\frac{\partial v_r}{\partial \theta}
+
\frac{1}{r^2}\left(\frac{\partial \rho}{\partial \theta}+\rho\cot\theta\right)v_r
\\
&\quad+
\frac{\rho}{r^2\sin^2\theta}\frac{\partial^2 v_\theta}{\partial \phi^2}
+
\frac{1}{r^2\sin^2\theta}\frac{\partial \rho}{\partial \phi}\frac{\partial v_\theta}{\partial \phi}
-
\frac{\rho\cot\theta}{r^2\sin\theta}\frac{\partial v_\phi}{\partial \phi}
-
\frac{\cot\theta}{r^2\sin\theta}\frac{\partial \rho}{\partial \phi}\,v_\phi
\Bigg].
\end{aligned}
$$

And

$$
\begin{aligned}
\left[\boldsymbol{\nabla}\cdot(\nu\rho\,\boldsymbol{\nabla}\mathbf v)\right]_\phi
={}&\nu\Bigg[
\rho\,\frac{\partial^2 v_\phi}{\partial r^2}
+
\left(\frac{\partial \rho}{\partial r}+\frac{2\rho}{r}\right)\frac{\partial v_\phi}{\partial r}
\\
&\quad+
\frac{\rho}{r^2}\frac{\partial^2 v_\phi}{\partial \theta^2}
+
\frac{1}{r^2}\left(\frac{\partial \rho}{\partial \theta}+\rho\cot\theta\right)\frac{\partial v_\phi}{\partial \theta}
\\
&\quad+
\frac{\rho}{r^2\sin^2\theta}\frac{\partial^2 v_\phi}{\partial \phi^2}
+
\frac{1}{r^2\sin^2\theta}\frac{\partial \rho}{\partial \phi}\frac{\partial v_\phi}{\partial \phi}
+
\frac{\rho}{r^2\sin\theta}\frac{\partial v_r}{\partial \phi}
+
\frac{1}{r^2\sin\theta}\frac{\partial \rho}{\partial \phi}\,v_r
\\
&\quad+
\frac{\rho\cot\theta}{r^2\sin\theta}\frac{\partial v_\theta}{\partial \phi}
+
\frac{\cot\theta}{r^2\sin\theta}\frac{\partial \rho}{\partial \phi}\,v_\theta
\Bigg].
\end{aligned}
$$




**Scalar loss:**
$$
\mathcal L
=
\left\langle
R_r^2 + R_\theta^2 + R_\phi^2
\right\rangle
$$


## Required components

1. Radial Residual only:
- Scalars: $$\rho,\ P,\ g$$
- Velocity: $$v_r,\ v_\theta,\ v_\phi$$
- Current: $$J_\theta,\ J_\phi$$
- Magnetic: $$B_\theta,\ B_\phi$$


2. All residuals
- Scalars: $$\rho,\ P,\ g$$
- Velocity: $$v_r,\ v_\theta,\ v_\phi$$
- Current: $$J_r,\ J_\theta,\ J_\phi$$
- Magnetic: $$B_r,\ B_\theta,\ B_\phi$$